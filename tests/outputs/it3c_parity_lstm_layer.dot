digraph Model {
    rankdir=TB;
    node [fontname="Microsoft YaHei,SimHei,Arial"];
    edge [fontname="Microsoft YaHei,SimHei,Arial"];

    subgraph cluster_lstm {
        label=<<B>lstm</B><BR/><FONT POINT-SIZE="9">LSTM: 1â†’10</FONT>>;
        style=filled;
        fillcolor="#E3F2FD80";
        fontname="Microsoft YaHei,SimHei,Arial";
        fontsize=11;
        margin=12;
        "5" [label=<lstm_ones<BR/><B>Input</B><BR/>[16, 1]> shape=ellipse style=filled fillcolor="#E3F2FD" fontsize=10];
        "6" [label=<lstm_W_ii<BR/><B>Parameter</B><BR/>[1, 10]<BR/>(10 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "7" [label=<lstm_W_hi<BR/><B>Parameter</B><BR/>[10, 10]<BR/>(100 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "8" [label=<lstm_b_i<BR/><B>Parameter</B><BR/>[1, 10]<BR/>(10 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "9" [label=<lstm_W_if<BR/><B>Parameter</B><BR/>[1, 10]<BR/>(10 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "10" [label=<lstm_W_hf<BR/><B>Parameter</B><BR/>[10, 10]<BR/>(100 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "11" [label=<lstm_b_f<BR/><B>Parameter</B><BR/>[1, 10]<BR/>(10 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "12" [label=<lstm_W_ig<BR/><B>Parameter</B><BR/>[1, 10]<BR/>(10 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "13" [label=<lstm_W_hg<BR/><B>Parameter</B><BR/>[10, 10]<BR/>(100 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "14" [label=<lstm_b_g<BR/><B>Parameter</B><BR/>[1, 10]<BR/>(10 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "15" [label=<lstm_W_io<BR/><B>Parameter</B><BR/>[1, 10]<BR/>(10 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "16" [label=<lstm_W_ho<BR/><B>Parameter</B><BR/>[10, 10]<BR/>(100 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "17" [label=<lstm_b_o<BR/><B>Parameter</B><BR/>[1, 10]<BR/>(10 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
        "18" [label=<lstm_x_ii<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "19" [label=<lstm_h_hi<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "20" [label=<lstm_b_i_bc<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "21" [label=<lstm_pre_i<BR/><B>Add</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "22" [label=<lstm_i_gate<BR/><B>Sigmoid</B><BR/>[16, 10]> shape=diamond style=filled fillcolor="#FFF3E0" fontsize=10];
        "23" [label=<lstm_x_if<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "24" [label=<lstm_h_hf<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "25" [label=<lstm_b_f_bc<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "26" [label=<lstm_pre_f<BR/><B>Add</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "27" [label=<lstm_f_gate<BR/><B>Sigmoid</B><BR/>[16, 10]> shape=diamond style=filled fillcolor="#FFF3E0" fontsize=10];
        "28" [label=<lstm_x_ig<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "29" [label=<lstm_h_hg<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "30" [label=<lstm_b_g_bc<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "31" [label=<lstm_pre_g<BR/><B>Add</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "32" [label=<lstm_g_gate<BR/><B>Tanh</B><BR/>[16, 10]> shape=diamond style=filled fillcolor="#FFF3E0" fontsize=10];
        "33" [label=<lstm_x_io<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "34" [label=<lstm_h_ho<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "35" [label=<lstm_b_o_bc<BR/><B>MatMul</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "36" [label=<lstm_pre_o<BR/><B>Add</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "37" [label=<lstm_o_gate<BR/><B>Sigmoid</B><BR/>[16, 10]> shape=diamond style=filled fillcolor="#FFF3E0" fontsize=10];
        "38" [label=<lstm_f_c<BR/><B>Multiply</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "39" [label=<lstm_i_g<BR/><B>Multiply</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "40" [label=<lstm_c<BR/><B>Add</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
        "41" [label=<lstm_tanh_c<BR/><B>Tanh</B><BR/>[16, 10]> shape=diamond style=filled fillcolor="#FFF3E0" fontsize=10];
        "42" [label=<lstm_h<BR/><B>Multiply</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
    }

    "1" [label=<input<BR/><B>Input</B><BR/>[16, 1]> shape=ellipse style=filled fillcolor="#E3F2FD" fontsize=10];
    "2" [label=<mask<BR/><B>Input</B><BR/>[16, 10]> shape=ellipse style=filled fillcolor="#E3F2FD" fontsize=10];
    "3" [label=<lstm_h_prev<BR/><B>State</B><BR/>[16, 10]> shape=cylinder style=filled fillcolor="#FFE0B2" fontsize=10];
    "4" [label=<lstm_c_prev<BR/><B>State</B><BR/>[16, 10]> shape=cylinder style=filled fillcolor="#FFE0B2" fontsize=10];
    "43" [label=<neg_one<BR/><B>Parameter</B><BR/>[1, 1]<BR/>(1 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
    "44" [label=<neg_h_prev<BR/><B>ScalarMultiply</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
    "45" [label=<delta<BR/><B>Add</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
    "46" [label=<masked_delta<BR/><B>Multiply</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
    "47" [label=<masked_h<BR/><B>Add</B><BR/>[16, 10]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
    "48" [label=<w_ho<BR/><B>Parameter</B><BR/>[10, 1]<BR/>(10 params)> shape=box style=filled fillcolor="#E8F5E9" fontsize=10];
    "49" [label=<pre_output<BR/><B>MatMul</B><BR/>[16, 1]> shape=box style="filled,rounded" fillcolor="#FFFDE7" fontsize=10];
    "50" [label=<output<BR/><B>Sigmoid</B><BR/>[16, 1]> shape=diamond style=filled fillcolor="#FFF3E0" fontsize=10];
    "51" [label=<target<BR/><B>Input</B><BR/>[16, 1]> shape=ellipse style=filled fillcolor="#E3F2FD" fontsize=10];
    "52" [label=<loss<BR/><B>MSELoss</B><BR/>[1, 1]> shape=doubleoctagon style=filled fillcolor="#FFEBEE" fontsize=10];

    "1" -> "18";
    "6" -> "18";
    "3" -> "19";
    "7" -> "19";
    "5" -> "20";
    "8" -> "20";
    "18" -> "21";
    "19" -> "21";
    "20" -> "21";
    "21" -> "22";
    "1" -> "23";
    "9" -> "23";
    "3" -> "24";
    "10" -> "24";
    "5" -> "25";
    "11" -> "25";
    "23" -> "26";
    "24" -> "26";
    "25" -> "26";
    "26" -> "27";
    "1" -> "28";
    "12" -> "28";
    "3" -> "29";
    "13" -> "29";
    "5" -> "30";
    "14" -> "30";
    "28" -> "31";
    "29" -> "31";
    "30" -> "31";
    "31" -> "32";
    "1" -> "33";
    "15" -> "33";
    "3" -> "34";
    "16" -> "34";
    "5" -> "35";
    "17" -> "35";
    "33" -> "36";
    "34" -> "36";
    "35" -> "36";
    "36" -> "37";
    "27" -> "38";
    "4" -> "38";
    "22" -> "39";
    "32" -> "39";
    "38" -> "40";
    "39" -> "40";
    "40" -> "41";
    "37" -> "42";
    "41" -> "42";
    "43" -> "44";
    "3" -> "44";
    "42" -> "45";
    "44" -> "45";
    "2" -> "46";
    "45" -> "46";
    "3" -> "47";
    "46" -> "47";
    "47" -> "49";
    "48" -> "49";
    "49" -> "50";
    "50" -> "52";
    "51" -> "52";
    "40" -> "4" [style=dashed color="#E67E22" label="t-1" fontcolor="#E67E22"];
    "42" -> "3" [style=dashed color="#E67E22" label="t-1" fontcolor="#E67E22"];
}
